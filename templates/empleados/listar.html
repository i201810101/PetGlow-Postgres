<!-- templates/empleados/empleados.html -->
{% extends "base.html" %}

{% block title %}Gestión de Empleados - PetGlow{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/empleados.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800"><i class="fas fa-users me-2"></i>Empleados</h1>
            <p class="mb-0 text-muted">Gestión de empleados del sistema</p>
        </div>
        <div>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalNuevoEmpleado">
                <i class="fas fa-user-plus me-1"></i>Nuevo Empleado
            </button>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-filter me-2"></i>Filtros</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label">Estado</label>
                    <select class="form-select" id="filtroEstado">
                        <option value="todos">Todos</option>
                        <option value="activo">Activos</option>
                        <option value="inactivo">Inactivos</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Especialidad</label>
                    <select class="form-select" id="filtroEspecialidad">
                        <option value="todos">Todas</option>
                        <option value="baño">Baño</option>
                        <option value="corte">Corte</option>
                        <option value="ambos">Ambos</option>
                        <option value="ventas">Ventas</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label">Buscar</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="filtroBusqueda" placeholder="Nombre, DNI, email...">
                        <button class="btn btn-outline-secondary" type="button" id="btnBuscar">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de empleados -->
    <div class="card shadow">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-list me-2"></i>Lista de Empleados</h6>
            <div class="text-muted">
                <span id="totalEmpleados">0</span> empleados encontrados
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="tablaEmpleados">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>DNI</th>
                            <th>Nombre</th>
                            <th>Teléfono</th>
                            <th>Email</th>
                            <th>Especialidad</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tbodyEmpleados">
                        <!-- Los datos se cargarán aquí -->
                    </tbody>
                </table>
            </div>
            
            <!-- Paginación -->
            <nav aria-label="Paginación" class="mt-4" id="paginacion">
                <ul class="pagination justify-content-center">
                    <!-- Se generará dinámicamente -->
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Modal: Nuevo Empleado -->
<div class="modal fade" id="modalNuevoEmpleado" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Nuevo Empleado</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="formNuevoEmpleado">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_dni" class="form-label required">DNI *</label>
                            <input type="text" class="form-control" id="nuevo_dni" name="dni" maxlength="20" required>
                            <div class="invalid-feedback">Ingrese un DNI válido</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_especialidad" class="form-label required">Especialidad *</label>
                            <select class="form-select" id="nuevo_especialidad" name="especialidad" required>
                                <option value="">Seleccionar...</option>
                                <option value="baño">Baño</option>
                                <option value="corte">Corte</option>
                                <option value="ambos">Ambos</option>
                                <option value="ventas">Ventas</option>
                            </select>
                            <div class="invalid-feedback">Seleccione una especialidad</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_nombre" class="form-label required">Nombres *</label>
                            <input type="text" class="form-control" id="nuevo_nombre" name="nombre" required>
                            <div class="invalid-feedback">Ingrese los nombres</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_apellido" class="form-label required">Apellidos *</label>
                            <input type="text" class="form-control" id="nuevo_apellido" name="apellido" required>
                            <div class="invalid-feedback">Ingrese los apellidos</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_telefono" class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="nuevo_telefono" name="telefono">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_email" class="form-label required">Email *</label>
                            <input type="email" class="form-control" id="nuevo_email" name="email" required>
                            <div class="invalid-feedback">Ingrese un email válido</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nuevo_fecha_contratacion" class="form-label">Fecha de Contratación</label>
                            <input type="date" class="form-control" id="nuevo_fecha_contratacion" name="fecha_contratacion">
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="nuevo_activo" name="activo" checked>
                                <label class="form-check-label" for="nuevo_activo">
                                    Empleado activo
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Usuario para sistema -->
                    <div class="border-top pt-3 mt-3">
                        <h6><i class="fas fa-key me-2"></i>Crear Usuario para Sistema</h6>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="crear_usuario" name="crear_usuario">
                            <label class="form-check-label" for="crear_usuario">
                                Crear usuario para acceso al sistema
                            </label>
                        </div>
                        
                        <div id="datos_usuario" style="display: none;">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nuevo_username" class="form-label">Username *</label>
                                    <input type="text" class="form-control" id="nuevo_username" name="username">
                                    <div class="form-text">Nombre de usuario para login</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="nuevo_password" class="form-label">Contraseña *</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="nuevo_password" name="password">
                                        <button class="btn btn-outline-secondary" type="button" id="verPassword">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                    <div class="form-text">Mínimo 6 caracteres</div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nuevo_rol" class="form-label">Rol *</label>
                                    <select class="form-select" id="nuevo_rol" name="rol">
                                        <option value="">Seleccionar...</option>
                                        <option value="admin">Administrador</option>
                                        <option value="gerente">Gerente</option>
                                        <option value="empleado">Empleado</option>
                                        <option value="cajero">Cajero</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Guardar Empleado
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Editar Empleado -->
<div class="modal fade" id="modalEditarEmpleado" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title"><i class="fas fa-edit me-2"></i>Editar Empleado</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form id="formEditarEmpleado">
                <input type="hidden" id="editar_id" name="id_empleado">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editar_dni" class="form-label required">DNI *</label>
                            <input type="text" class="form-control" id="editar_dni" name="dni" maxlength="20" required>
                            <div class="invalid-feedback">Ingrese un DNI válido</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editar_especialidad" class="form-label required">Especialidad *</label>
                            <select class="form-select" id="editar_especialidad" name="especialidad" required>
                                <option value="">Seleccionar...</option>
                                <option value="baño">Baño</option>
                                <option value="corte">Corte</option>
                                <option value="ambos">Ambos</option>
                                <option value="ventas">Ventas</option>
                            </select>
                            <div class="invalid-feedback">Seleccione una especialidad</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editar_nombre" class="form-label required">Nombres *</label>
                            <input type="text" class="form-control" id="editar_nombre" name="nombre" required>
                            <div class="invalid-feedback">Ingrese los nombres</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editar_apellido" class="form-label required">Apellidos *</label>
                            <input type="text" class="form-control" id="editar_apellido" name="apellido" required>
                            <div class="invalid-feedback">Ingrese los apellidos</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editar_telefono" class="form-label">Teléfono</label>
                            <input type="text" class="form-control" id="editar_telefono" name="telefono">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editar_email" class="form-label required">Email *</label>
                            <input type="email" class="form-control" id="editar_email" name="email" required>
                            <div class="invalid-feedback">Ingrese un email válido</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editar_fecha_contratacion" class="form-label">Fecha de Contratación</label>
                            <input type="date" class="form-control" id="editar_fecha_contratacion" name="fecha_contratacion">
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check mt-4">
                                <input class="form-check-input" type="checkbox" id="editar_activo" name="activo">
                                <label class="form-check-label" for="editar_activo">
                                    Empleado activo
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Información del usuario si existe -->
                    <div class="border-top pt-3 mt-3" id="info_usuario_container">
                        <h6><i class="fas fa-key me-2"></i>Información del Usuario</h6>
                        <div id="info_usuario">
                            <p class="text-muted">Cargando información del usuario...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save me-1"></i>Actualizar Empleado
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal: Ver Detalles -->
<div class="modal fade" id="modalVerEmpleado" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title"><i class="fas fa-user me-2"></i>Detalles del Empleado</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4 text-center mb-4">
                        <div class="avatar-empleado bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 100px; height: 100px; font-size: 2.5rem;">
                            <i class="fas fa-user"></i>
                        </div>
                        <h4 class="mt-3" id="ver_nombre_completo"></h4>
                        <span class="badge" id="ver_estado_badge"></span>
                    </div>
                    <div class="col-md-8">
                        <div class="row">
                            <div class="col-6 mb-3">
                                <strong>DNI:</strong>
                                <p class="mb-0" id="ver_dni"></p>
                            </div>
                            <div class="col-6 mb-3">
                                <strong>Especialidad:</strong>
                                <p class="mb-0" id="ver_especialidad"></p>
                            </div>
                            <div class="col-6 mb-3">
                                <strong>Teléfono:</strong>
                                <p class="mb-0" id="ver_telefono"></p>
                            </div>
                            <div class="col-6 mb-3">
                                <strong>Email:</strong>
                                <p class="mb-0" id="ver_email"></p>
                            </div>
                            <div class="col-6 mb-3">
                                <strong>Fecha de Contratación:</strong>
                                <p class="mb-0" id="ver_fecha_contratacion"></p>
                            </div>
                            <div class="col-6 mb-3">
                                <strong>Estado:</strong>
                                <p class="mb-0" id="ver_estado"></p>
                            </div>
                        </div>
                        
                        <div class="border-top pt-3 mt-3">
                            <h6><i class="fas fa-key me-2"></i>Información del Usuario</h6>
                            <div id="ver_info_usuario">
                                <p class="text-muted">Cargando información del usuario...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-info" onclick="imprimirDetalles()">
                    <i class="fas fa-print me-1"></i>Imprimir
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Confirmar Eliminación -->
<div class="modal fade" id="modalConfirmarEliminar" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Confirmar Eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>¿Está seguro que desea <strong class="text-danger">desactivar</strong> al empleado?</p>
                <p class="mb-0"><strong id="empleado_a_eliminar"></strong></p>
                <div class="alert alert-warning mt-3">
                    <i class="fas fa-info-circle me-2"></i>
                    Nota: Los empleados no se eliminan permanentemente, solo se desactivan para mantener el historial.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmarEliminar">
                    <i class="fas fa-trash-alt me-1"></i>Desactivar Empleado
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/empleados.js') }}"></script>
{% endblock %}